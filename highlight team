-- üß© Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local localPlayer = Players.LocalPlayer -- ‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡∏≤‡πÄ‡∏≠‡∏á

-- üìÅ ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πá‡∏ö Highlight
local highlightFolder = Workspace:FindFirstChild("HighlightContainer")
if not highlightFolder then
    highlightFolder = Instance.new("Folder")
    highlightFolder.Name = "HighlightContainer"
    highlightFolder.Parent = Workspace
end

-- üé® ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡∏°
local function getTeamColor(player)
    if not player.Team or not localPlayer.Team then
        -- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏°‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡∏° ‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏´‡∏°‡∏î
        return Color3.fromRGB(255, 0, 0)
    end
    if player.Team == localPlayer.Team then
        return Color3.fromRGB(0, 170, 255) -- ‡∏™‡∏µ‡∏ü‡πâ‡∏≤ (‡∏ó‡∏µ‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤)
    else
        return Color3.fromRGB(255, 0, 0) -- ‡∏™‡∏µ‡πÅ‡∏î‡∏á (‡∏ó‡∏µ‡∏°‡∏®‡∏±‡∏ï‡∏£‡∏π)
    end
end

-- ‚ú® ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Highlight
local function addESP(player)
    if player == localPlayer then return end -- ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
    if not player.Character then return end

    local name = player.Name .. "_ESP"
    local existing = highlightFolder:FindFirstChild(name)
    if existing then existing:Destroy() end -- ‡∏•‡∏ö‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô

    local highlight = Instance.new("Highlight")
    highlight.Name = name
    highlight.Adornee = player.Character
    highlight.FillColor = getTeamColor(player)
    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.Parent = highlightFolder
end

-- ‚ùå ‡∏•‡∏ö Highlight ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏≠‡∏Å
local function removeESP(player)
    local highlight = highlightFolder:FindFirstChild(player.Name .. "_ESP")
    if highlight then
        highlight:Destroy()
    end
end

-- üë• Event ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà
Players.PlayerAdded:Connect(function(player)
    -- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏° ESP
    player.CharacterAdded:Connect(function()
        addESP(player)
    end)
    -- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏µ‡∏° ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ ESP ‡πÉ‡∏´‡πâ‡∏î‡πâ‡∏ß‡∏¢
    player:GetPropertyChangedSignal("Team"):Connect(function()
        addESP(player)
    end)
end)

-- ‚ùå Event ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏≠‡∏Å
Players.PlayerRemoving:Connect(removeESP)

-- üöÄ ‡∏™‡∏£‡πâ‡∏≤‡∏á ESP ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
for _, player in pairs(Players:GetPlayers()) do
    if player ~= localPlayer and player.Character then
        addESP(player)
    end
    player.CharacterAdded:Connect(function()
        addESP(player)
    end)
    player:GetPropertyChangedSignal("Team"):Connect(function()
        addESP(player)
    end)
end

-- üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å‡πÄ‡∏ü‡∏£‡∏°
RunService.RenderStepped:Connect(function()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= localPlayer and player.Character then
            local highlight = highlightFolder:FindFirstChild(player.Name .. "_ESP")
            if highlight then
                highlight.Adornee = player.Character
                highlight.FillColor = getTeamColor(player)
            end
        end
    end
end)
