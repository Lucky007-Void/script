local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

local Window = Fluent:CreateWindow({
    Title = "Fisch",
    SubTitle = "LuckyZ Hub",
    TabWidth = 160,
    Size = UDim2.fromOffset(500, 350),
    Acrylic = false,
    Theme = "Dark"
})

local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
local Button = Instance.new("ImageButton", ScreenGui)

Button.Size = UDim2.new(0, 60, 0, 60)
Button.Position = UDim2.new(0, 20, 0, 20)
Button.BackgroundTransparency = 1
Button.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"
Button.ZIndex = 9999
Button.Active = true
Button.Draggable = true
Button.Image = "rbxassetid://136609951292659"

local isVisible = true
Button.MouseButton1Click:Connect(function()
	isVisible = not isVisible
	Window:Minimize()
end)


local Player = game:GetService("Players")
local LocalPlayer = Player.LocalPlayer
local Char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Char:WaitForChild("Humanoid")
local VirtualInputManager = game:GetService("VirtualInputManager")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local GuiService = game:GetService("GuiService")

local function equipitem(v)
    if LocalPlayer.Backpack:FindFirstChild(v) then
        local a = LocalPlayer.Backpack:FindFirstChild(v)
        Humanoid:EquipTool(a)
    end
end

local TabMain = Window:AddTab({ Title = "Main", Icon = "rbxassetid://4483345998" })

TabMain:AddToggle("AutoCast", {
    Title = "AutoCast",
    Default = false,
    Callback = function(v)
        _G.AutoCast = v
        pcall(function()
            while _G.AutoCast do
                task.wait(0.2)
                local Rod = Char:FindFirstChildOfClass("Tool")
                if Rod and Rod:FindFirstChild("events") and Rod.events:FindFirstChild("castAsync") then
                   Rod.events.castAsync:InvokeServer(math.random(95,100), 1)
                end
            end
        end)
    end
})

TabMain:AddToggle("AutoShake", {
    Title = "AutoShake",
    Default = false,
    Callback = function(v)
        _G.AutoShake = v
        pcall(function()
            local function startShakeUI(shakeUI)
                if not shakeUI then return end
                local function tryClick(button)
                    if button and button.Visible then
                        GuiService.SelectedObject = button
                        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
                        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Return, false, game)
                    end
                end
                local function monitorSafezone()
                    local safezone = shakeUI:FindFirstChild("safezone")
                    if safezone then
                        local button = safezone:FindFirstChild("button")
                        tryClick(button)
                        safezone.ChildAdded:Connect(function(child)
                            if _G.AutoShake and child.Name == "button" then
                                tryClick(child)
                                child:GetPropertyChangedSignal("Visible"):Connect(function()
                                    if _G.AutoShake and child.Visible then
                                        tryClick(child)
                                    end
                                end)
                            end
                        end)
                        if button then
                            button:GetPropertyChangedSignal("Visible"):Connect(function()
                                if _G.AutoShake and button.Visible then
                                    tryClick(button)
                                end
                            end)
                        end
                    end
                end
                shakeUI:GetPropertyChangedSignal("Enabled"):Connect(function()
                    if _G.AutoShake and shakeUI.Enabled then
                        monitorSafezone()
                    end
                end)
                if shakeUI.Enabled then
                    monitorSafezone()
                end
            end
            local PlayerGUI = LocalPlayer:WaitForChild("PlayerGui")
            if PlayerGUI:FindFirstChild("shakeui") then
                startShakeUI(PlayerGUI.shakeui)
            end
            PlayerGUI.ChildAdded:Connect(function(child)
                if _G.AutoShake and child.Name == "shakeui" then
                    startShakeUI(child)
                end
            end)
        end)
    end
})

TabMain:AddToggle("AutoReel", {
    Title = "AutoReel",
    Default = false,
    Callback = function(v)
        _G.AutoReel = v
        if not _G.AutoReel then return end
        task.spawn(function()
            local playerGui = LocalPlayer:WaitForChild("PlayerGui")
            local reelEvent

            local function handleReel(reelGui)
                if reelGui:IsA("ScreenGui") and reelGui.Name == "reel" then
                    repeat task.wait()
                    until not _G.AutoReel or (reelGui.Enabled == true)

                    if not _G.AutoReel then return end
                    local bar = reelGui:WaitForChild("bar", 2)
                    if bar then
                        task.wait(2)
                        ReplicatedStorage.events.reelfinished:FireServer(100, true)
                    end
                end
            end

            for _, gui in ipairs(playerGui:GetChildren()) do
                handleReel(gui)
            end
            
            reelEvent = playerGui.ChildAdded:Connect(handleReel)
            repeat task.wait() until not _G.AutoReel
            if reelEvent then
                reelEvent:Disconnect()
            end
        end)
    end
})

TabMain:AddToggle("Anchored", {
    Title = "Anchored",
    Default = false,
    Callback = function(state)
        local Players = game:GetService("Players")
        local LocalPlayer = Players.LocalPlayer
        local RunService = game:GetService("RunService")

        if state then
            local initialCFrame = nil

            -- รอให้ Character พร้อม
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                initialCFrame = LocalPlayer.Character.HumanoidRootPart.CFrame
            else
                LocalPlayer.CharacterAdded:Wait()
                LocalPlayer.Character:WaitForChild("HumanoidRootPart")
                initialCFrame = LocalPlayer.Character.HumanoidRootPart.CFrame
            end

            -- สร้างการล็อกตำแหน่งและมุม
            _G.TPLockConnection = RunService.RenderStepped:Connect(function()
                if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                    LocalPlayer.Character.HumanoidRootPart.CFrame = initialCFrame
                end
            end)
        else
            if _G.TPLockConnection then
                _G.TPLockConnection:Disconnect()
                _G.TPLockConnection = nil
            end
        end
    end
})

task.spawn(function()
    while task.wait() do
        if _G.AutoCast then
            pcall(function()
                for _, v in pairs(LocalPlayer.Backpack:GetChildren()) do
                    if v:IsA("Tool") and (v.Name:lower():find("rod") or v.Name == "Elder Mossripper" or v.Name == "Onirifalx") then
                        equipitem(v.Name)
                    end
                end
            end)
        end
    end
end)

local TabAuto = Window:AddTab({ Title = "Auto", Icon = "rbxassetid://6035190846" })

local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local placeId = game.PlaceId

local SettingsFile = "LuckyZHubFisch.json"
local Settings = {}

if isfile and isfile(SettingsFile) then
	local success, data = pcall(function()
		return HttpService:JSONDecode(readfile(SettingsFile))
	end)
	if success and data then
		Settings = data
	end
end

local function SaveSettings()
	if writefile then
		writefile(SettingsFile, HttpService:JSONEncode({
			AutoElderMossjaw = Settings.AutoElderMossjaw
		}))
	end
end

local function FindRandomServer()
	local url = "https://games.roblox.com/v1/games/"..placeId.."/servers/Public?sortOrder=Asc&limit=100"
	local success, result = pcall(function() return game:HttpGet(url) end)
	if success then
		local data = HttpService:JSONDecode(result)
		local servers = {}
		for _, server in ipairs(data.data) do
			if server.playing < server.maxPlayers and server.id ~= game.JobId then
				table.insert(servers, server.id)
			end
		end
		if #servers > 0 then
			return servers[math.random(1, #servers)]
		end
	end
	return nil
end

local function TeleportToRandomServer()
	local jobId = FindRandomServer()
	if jobId then
		TeleportService:TeleportToPlaceInstance(placeId, jobId, LocalPlayer)
	end
end

local function WaitForCharacter()
	if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
		LocalPlayer.CharacterAdded:Wait()
		LocalPlayer.Character:WaitForChild("HumanoidRootPart")
	end
end

local VirtualInputManager = game:GetService("VirtualInputManager")
local Camera = workspace.CurrentCamera

local function ClickRightCenter()
	local viewport = Camera.ViewportSize
	local x = viewport.X - 10
	local y = viewport.Y / 2
	VirtualInputManager:SendMouseButtonEvent(x, y, 0, true, game, 1)
	task.wait(0.05)
	VirtualInputManager:SendMouseButtonEvent(x, y, 0, false, game, 1)
end

local ElderMossjawPos = Vector3.new(-4863.9990234375, -1793.8779296875, -10125.3154296875)

local function StartAutoElderMossjaw()
	task.spawn(function()
		while Settings.AutoElderMossjaw do
			task.wait(1)
			local moss = workspace:FindFirstChild("Elder Mossjaw")
			if moss then
				WaitForCharacter()
				task.wait(2)
				ClickRightCenter()
				task.wait(2)
				if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
					LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(ElderMossjawPos)
				end
				task.wait(2)
				_G.AutoCast = true
				_G.AutoShake = true
				_G.AutoReel = true

				task.spawn(function()
					while _G.AutoCast and Settings.AutoElderMossjaw do
						task.wait()
						local Rod = Char:FindFirstChildOfClass("Tool")
						if Rod and Rod:FindFirstChild("events") and Rod.events:FindFirstChild("castAsync") then
							Rod.events.castAsync:InvokeServer(math.random(95,100), 1)
						end
					end
				end)

				task.spawn(function()
					while _G.AutoShake and Settings.AutoElderMossjaw do
						task.wait()
						local shake = LocalPlayer.PlayerGui:FindFirstChild("shakeui")
						if shake and shake:FindFirstChild("safezone") then
							local btn = shake.safezone:FindFirstChild("button")
							if btn and btn.Visible then
								GuiService.SelectedObject = btn
								VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
								VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Return, false, game)
							end
						end
					end
				end)

				task.spawn(function()
	                while _G.AutoReel and Settings.AutoElderMossjaw do
		                task.wait()
		                local reelGui = LocalPlayer.PlayerGui:FindFirstChild("reel")
                        if reelGui and reelGui.Enabled then
		                    local bar = reelGui:WaitForChild("bar")
            		       	if bar then
	                    	    task.wait(2)
	           			        ReplicatedStorage.events.reelfinished:FireServer(100, true)
			             	    end
		          	        end
	                    end
                    end)

				repeat task.wait(2) until not workspace:FindFirstChild("Elder Mossjaw") or not Settings.AutoElderMossjaw
				if Settings.AutoElderMossjaw then
					TeleportToRandomServer()
				end
			else
                task.wait(2)
				TeleportToRandomServer()
			end
		end
	end)
end


TabAuto:AddToggle("AutoElderMossjaw", {
	Title = "Auto Elder Mossjaw",
	Default = Settings.AutoElderMossjaw or false,
	Callback = function(v)
		Settings.AutoElderMossjaw = v
		SaveSettings()
		if v then
			StartAutoElderMossjaw()
		end
	end
})

if Settings.AutoElderMossjaw then
	StartAutoElderMossjaw()
end

for _, prompt in ipairs(workspace:GetDescendants()) do
    if prompt:IsA("ProximityPrompt") then
        prompt.RequiresLineOfSight = false
    end
end

local function teleportTo(position)
    local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if hrp then
        hrp.CFrame = CFrame.new(position)
    end
end

local positions = {
    Vector3.new(-25.48101043701172, 190.60992431640625, -11692.2548828125),
    Vector3.new(-13.151168823242188, 147.7499237060547, -11465.1083984375),
    Vector3.new(141.96009826660156, 146.47857666015625, -11596.5751953125),
    Vector3.new(125.0282974243164, 146.16824340820312, -11497.0888671875),
    Vector3.new(200.76441955566406, 144.747802734375, -11583.796875),
    Vector3.new(174.09771728515625, 163.09396362304688, -11449.578125),
    Vector3.new(231.10092163085938, 144.63844299316406, -11465.9296875),
    Vector3.new(263.5283508300781, 163.12301635742188, -11568.59375),
    Vector3.new(295.90106201171875, 156.24871826171875, -11522.2275390625),
    Vector3.new(296.85308837890625, 164.49420166015625, -11722.1611328125),
}

local autoTeleportEnabled = false

local function startAutoTeleport()
    while autoTeleportEnabled do
        for _, pos in ipairs(positions) do
            if not autoTeleportEnabled then break end

            teleportTo(pos)
            task.wait(0.5)

            VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)
            task.wait(0.1)
            VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.E, false, game)

            task.wait(15)
        end

        if autoTeleportEnabled then
            task.wait(605)
        end
    end
end

TabAuto:AddToggle("Auto Candy", {
    Title = "Auto Candy",
    Default = false,
    Callback = function(state)
        autoTeleportEnabled = state
        if state then
            task.spawn(startAutoTeleport)
        end
    end
})


_G.AutoAppraise = false
local heldToolName = nil

TabAuto:AddToggle("AutoAppraise", {
    Title = "Auto Appraise",
    Default = false,
    Callback = function(v)
        _G.AutoAppraise = v
        if v then
            task.spawn(function()
                local tool = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Tool")
                if not tool then
                    _G.AutoAppraise = false
                    return
                end

                heldToolName = tool.Name

                while _G.AutoAppraise do
                    task.wait(0.05)

                    local holdingTool = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Tool")
                    if not holdingTool or holdingTool.Name ~= heldToolName then
                        local backpackTool = LocalPlayer.Backpack:FindFirstChild(heldToolName)
                        if backpackTool and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
                            pcall(function()
                                LocalPlayer.Character.Humanoid:EquipTool(backpackTool)
                            end)
                        else
                            _G.AutoAppraise = false
                            return
                        end
                        continue
                    end

                    if holdingTool:FindFirstChild("shroudedtemplate") then
                        local foundNew = false

                        for _, t in pairs(LocalPlayer.Backpack:GetChildren()) do
                            if t:IsA("Tool") and t.Name == heldToolName and t ~= holdingTool then
                                if not t:FindFirstChild("shroudedtemplate") then
                                    pcall(function()
                                        LocalPlayer.Character.Humanoid:EquipTool(t)
                                    end)
                                    foundNew = true
                                    break
                                end
                            end
                        end

                        if not foundNew then
                            _G.AutoAppraise = false
                            return
                        end

                        continue
                    end

                    local args = {6, 1}
                    pcall(function()
                        ReplicatedStorage:WaitForChild("packages"):WaitForChild("Net"):WaitForChild("RF/DialogInteract"):InvokeServer(unpack(args))
                    end)
                end
            end)
        end
    end
})

TabAuto:AddButton({
    Title = "Sell All Fish",
    Description = "ขายปลาทั้งหมด",
    Callback = function()
        ReplicatedStorage.events.SellAll:InvokeServer()
    end
})

TabAuto:AddButton({
    Title = "Sell Fish in Hand",
    Description = "ขายปลาในมือ",
    Callback = function()
        ReplicatedStorage.events.Sell:InvokeServer()
    end
})

local TabTP = Window:AddTab({ Title = "Teleport", Icon = "rbxassetid://6035190842" })

local locations = {
    ["Merchant"] = Vector3.new(464.740417, 150.62973, 229.492584),
    ["Appraiser"] = Vector3.new(447.3258361816406, 150.54901123046875, 207.81690979003906),
    ["Pearl"] = Vector3.new(-2019.4090576171875, 130.8851776123047, 584.6004028320312),
    ["The Depths"] = Vector3.new(940.204407, -738.083374, 1457.24158),
    ["The Depths2"] = Vector3.new(1382.587646484375, -604.9406127929688, 2341.161376953125),
    ["Castaway"] = Vector3.new(619.7119140625, 162.12498474121094, -1832.619873046875),
    ["Mossjew"] = Vector3.new(-4863.9990234375, -1793.8779296875, -10125.3154296875),
    ["Kraken"] = Vector3.new(-4377.296875, -996.2604370117188, 2064.634033203125),
    ["Scylla"] = Vector3.new(-2339.830322265625, -11182.8818359375, 7074.814453125),
    ["Craft"] = Vector3.new(-3156.822021484375, -747.2178955078125, 1697.4261474609375),
    ["Sundial"] = Vector3.new(-1148, 134.499985, -1075),
    ["Windset"] = Vector3.new(2849, 178.333237, 2702),
    ["Smokescreen"] = Vector3.new(2789, 139.825485, -625),
    ["Tempest"] = Vector3.new(35, 132.500015, 1943),
    ["Aurora"] = Vector3.new(-1809.96142578125, -136.87164306640625, -3282.722900390625),
    ["QCrate"] = Vector3.new(-217.9184112548828, 135.0543975830078, 1893.77880859375),
    ["Enchant"] = Vector3.new(1309.3783, -805.221191, -98.6691666),
    ["Relic"] = Vector3.new(-957.766052, 222.000015, -987.641968)
}

local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")

local placeId = game.PlaceId
local currentJobId = game.JobId

local function teleport(location)
    local player = LocalPlayer
    if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        player.Character.HumanoidRootPart.CFrame = CFrame.new(location)
    end
end

TabTP:AddDropdown("Teleport NPC", {
    Title = "Select NPC",
    Values = {"Merchant", "Appraiser"},
    Multi = false,
    Callback = function(v)
        teleport(locations[v])
    end
})

TabTP:AddDropdown("Teleport Zone", {
    Title = "Select Zone",
    Values = {"Pearl", "The Depths", "The Depths2", "Castaway"},
    Multi = false,
    Callback = function(v)
        teleport(locations[v])
    end
})

TabTP:AddDropdown("Teleport Zone Boss", {
    Title = "Select Zone Boss",
    Values = {"Mossjew", "Kraken", "Scylla"},
    Multi = false,
    Callback = function(v)
        teleport(locations[v])
    end
})

TabTP:AddDropdown("Teleport Totem", {
    Title = "Select Totem",
    Values = {"Sundial", "Windset", "Smokescreen", "Tempest", "Aurora"},
    Multi = false,
    Callback = function(v)
        teleport(locations[v])
    end
})

TabTP:AddDropdown("Teleport Shop", {
    Title = "Select Shop",
    Values = {"Enchant", "Relic", "Craft", "QCrate"},
    Multi = false,
    Callback = function(v)
        teleport(locations[v])
    end
})

local function findRandomServer()
	local url = "https://games.roblox.com/v1/games/"..placeId.."/servers/Public?sortOrder=Asc&limit=100"

	local success, result = pcall(function()
		return game:HttpGet(url)
	end)

	if success then
		local data = HttpService:JSONDecode(result)
		local servers = {}

		for _, server in ipairs(data.data) do
			if server.id ~= currentJobId then
				table.insert(servers, server.id)
			end
		end

		if #servers > 0 then
			return servers[math.random(1, #servers)]
		end
	end
	return nil
end

local function teleportToRandomServer()
	local jobId = findRandomServer()
	if jobId then
		TeleportService:TeleportToPlaceInstance(placeId, jobId, Players.LocalPlayer)
	else
		warn("ไม่พบเซิร์ฟเวอร์สุ่ม")
	end
end

TabTP:AddButton({
    Title = "TPRandomServer",
    Description = "TPRandomServer",
    Callback = function()
        teleportToRandomServer()
    end
})
