local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()

local Window = Fluent:CreateWindow({
    Title = "Stand Power",
    SubTitle = "by LuckyZ Hub",
    TabWidth = 120,
    Size = UDim2.fromOffset(520, 320),
    Acrylic = false,
    Theme = "Dark"
})

local Tab = Window:AddTab({ Title = "Farm", Icon = "rbxassetid://4483345998" })

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local spawnedItems = workspace:WaitForChild("SpawnedItems")
local VirtualInputManager = game:GetService("VirtualInputManager")
local Camera = workspace.CurrentCamera
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")

local placeId = game.PlaceId
local currentJobId = game.JobId

local targetItems = {
    ["Candy"] = true,
    ["Candy Basket"] = true,
    ["Arrow"] = true,
    ["Locacaca Fruit"] = true,
}

local function ClickCenter()
	local viewport = Camera.ViewportSize
	local x = viewport.X / 2
	local y = viewport.Y / 2
	VirtualInputManager:SendMouseButtonEvent(x, y, 0, true, game, 1)
	task.wait(0.05)
	VirtualInputManager:SendMouseButtonEvent(x, y, 0, false, game, 1)
end

local function fixPrompt(item)
    if item:IsA("Model") and targetItems[item.Name] then
        local handle = item:FindFirstChild("Handle")
        if handle then
            for _, obj in pairs(handle:GetDescendants()) do
                if obj:IsA("ProximityPrompt") then
                    obj.HoldDuration = 0
                end
            end
        end
    end
end

for _, item in pairs(spawnedItems:GetChildren()) do
    fixPrompt(item)
end

spawnedItems.ChildAdded:Connect(function(item)
    fixPrompt(item)
end)

local function getNearestItem(itemName)
    local nearestItem = nil
    local nearestDist = math.huge
    for _, item in pairs(spawnedItems:GetChildren()) do
        if item:IsA("Model") and item.Name == itemName then
            local handle = item:FindFirstChild("Handle")
            local grabPrompt = handle and handle:FindFirstChildWhichIsA("ProximityPrompt")
            if handle and grabPrompt then
                local dist = (humanoidRootPart.Position - handle.Position).Magnitude
                if dist < nearestDist then
                    nearestDist = dist
                    nearestItem = handle
                end
            end
        end
    end
    return nearestItem
end

local function autoGrab(itemName, toggleVar)
    while _G[toggleVar] do
        local nearestItem = getNearestItem(itemName)
        if nearestItem then
            humanoidRootPart.CFrame = nearestItem.CFrame + Vector3.new(0, 2, 0)
            local grabPrompt = nearestItem:FindFirstChildWhichIsA("ProximityPrompt")
            if grabPrompt then
                grabPrompt.HoldDuration = 0
                fireproximityprompt(grabPrompt)
            end
        end
        task.wait()
    end
end

local function findTool(name)
    for _, tool in ipairs(player.Backpack:GetChildren()) do
        if tool.Name == name then
            return tool
        end
    end
    return nil
end

local function equipTool(toolName)
	local tool = findTool(toolName)
	if tool then
		player.Character.Humanoid:EquipTool(tool)
		return true
	end
	return false
end

local function useToolLoop(toolName, toggleVar)
	while _G[toggleVar] do
		local tool = player.Character and player.Character:FindFirstChild(toolName)
		if not tool then
			equipTool(toolName)
		else
			ClickCenter()
		end
        task.wait(0.05)
	end
end

Tab:AddToggle("AutoCollectCandy", {
    Title = "Auto Collect Candy",
    Default = false,
    Callback = function(state)
        _G.autoCollect = state
        if state then
            task.spawn(autoGrab, "Candy", "autoCollect")
        end
    end
})

Tab:AddToggle("AutoCollectBasket", {
    Title = "Auto Collect Candy Basket",
    Default = false,
    Callback = function(state)
        _G.autoBasket = state
        if state then
            task.spawn(autoGrab, "Candy Basket", "autoBasket")
        end
    end
})

Tab:AddToggle("AutoUseCandy", {
    Title = "Auto Use Candy",
    Default = false,
    Callback = function(state)
        _G.autoUseCandy = state
        if state then
            task.spawn(useToolLoop, "Candy", "autoUseCandy")
        end
    end
})

Tab:AddToggle("AutoUseBasket", {
    Title = "Auto Use Candy Basket",
    Default = false,
    Callback = function(state)
        _G.autoUseBasket = state
        if state then
            task.spawn(useToolLoop, "Candy Basket", "autoUseBasket")
        end
    end
})

Tab:AddToggle("AutoCollectArrow", {
    Title = "Auto Collect Arrow",
    Default = false,
    Callback = function(state)
        _G.autoArrow = state
        if state then
            task.spawn(autoGrab, "Arrow", "autoArrow")
        end
    end
})

Tab:AddToggle("AutoCollectLocaca", {
    Title = "Auto Collect Locaca",
    Default = false,
    Callback = function(state)
        _G.autoLocaca = state
        if state then
            task.spawn(autoGrab, "Locacaca Fruit", "autoLocaca")
        end
    end
})

local TabTP = Window:AddTab({ Title = "Teleport", Icon = "rbxassetid://6035190842" })

-- üìç ‡πÄ‡∏û‡∏¥‡πà‡∏° CFrame ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á (CFrame.new(Position, LookAt))
local locations = {
    ["Bank"] = CFrame.new(Vector3.new(-85.67863464355469, 2.8666749000549316, -57.05775833129883), Vector3.new(0.00011417376663303003, -3.4151412364735734e-08, -1)),
    ["Shop"] = CFrame.new(Vector3.new(903.0167236328125, 3.158618450164795, -548.1094360351562), Vector3.new(-0.000008531090315955225, 7.364124599007482e-08, -1)),
    ["Diego"] = CFrame.new(Vector3.new(600.8616943359375, 61.156192779541016, 876.5402221679688), Vector3.new(0.0000022957772216614103, 8.747453961177598e-08, -1)),
    ["Dio"] = CFrame.new(Vector3.new(1018.2171630859375, 3.158618450164795, -408.26019287109375), Vector3.new(0.0000028156744065199746, -2.048044400737581e-08, -1)),
    ["The Park"] = CFrame.new(Vector3.new(370.802001953125, 3.522308826446533, 65.10295104980469), Vector3.new(-0.000007719565473962575, 1.0695021757101131e-07, -1)),
}


local function teleport(location)
    if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        player.Character.HumanoidRootPart.CFrame = location
    end
end

local function findServer()
	local url = "https://games.roblox.com/v1/games/"..placeId.."/servers/Public?sortOrder=Asc&limit=100"
	local success, result = pcall(function()
		return game:HttpGet(url)
	end)
	if success then
		local data = HttpService:JSONDecode(result)
		for _, server in ipairs(data.data) do
			if server.id ~= currentJobId then
				return server.id
			end
		end
	end
	return nil
end

local function findRandomServer()
	local url = "https://games.roblox.com/v1/games/"..placeId.."/servers/Public?sortOrder=Asc&limit=100"

	local success, result = pcall(function()
		return game:HttpGet(url)
	end)

	if success then
		local data = HttpService:JSONDecode(result)
		local servers = {}

		for _, server in ipairs(data.data) do
			if server.id ~= currentJobId then
				table.insert(servers, server.id)
			end
		end

		if #servers > 0 then
			return servers[math.random(1, #servers)] -- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°
		end
	end
	return nil
end

local function teleportToLowestServer()
	local jobId = findServer()
	if jobId then
		TeleportService:TeleportToPlaceInstance(placeId, jobId, Players.LocalPlayer)
	end
end

local function teleportToRandomServer()
	local jobId = findRandomServer()
	if jobId then
		TeleportService:TeleportToPlaceInstance(placeId, jobId, Players.LocalPlayer)
	end
end


TabTP:AddDropdown("Teleport", {
    Title = "Select Teleport",
    Values = {"Bank", "Shop", "Diego", "Dio", "The Park"},
    Multi = false,
    Callback = function(v)
        teleport(locations[v])
    end
})

TabTP:AddButton({
    Title = "Teleport To Random Server",
    Description = "‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏™‡∏∏‡πà‡∏°",
    Callback = function()
        teleportToRandomServer()
    end
})

TabTP:AddButton({
    Title = "Teleport To Lowest Server",
    Description = "‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
    Callback = function()
        teleportToLowestServer()
    end
})
